
clear all;
close all;
clc;

addpath("../Tools");
addpath("../Regressors");
rng('default');

plot_constraint = true;



%% 1) Create 2d constrained environment (q,qdot)

% Sample datapoints as constrained environement

sc = 0.1;
% Constraint 1
m1 = sc*[-10;35];	  %Mean
sigma1 = sc^2*10*eye(2);	  %Variance
d1 = 100;             %Length
z1 = mvnrnd(m1,sigma1,d1);


% Constraint 2
m2 = sc*[25;15];     %Mean
sigma2 = sc^2*diag([30;30]);	  %Variance
d2 = 250;             %Length
z2 = mvnrnd(m2,sigma2,d2);

% Constraint 3
m3 = sc*[-25;-10];	%Mean
sigma3 = sc^2*diag([6;30]);	    %Variance
d3 = 300;               %Length
z3 = mvnrnd(m3,sigma3,d3);


X = [z1;z2;z3];
gm = fitgmdist(X,3);

x1 = linspace(-5,5);
x2 = linspace(-5,5);
[X1,X2]=meshgrid(x1,x2);

X1=X1(:);
X2=X2(:);
Y = [X1,X2];

% Mahanabolis distance for each cluster
MahaDist_1 = @(x) sqrt(diag((x-gm.mu(1,:))*(gm.Sigma(:,:,1)\(x-gm.mu(1,:))')));
MahaDist_2 = @(x) sqrt(diag((x-gm.mu(2,:))*(gm.Sigma(:,:,2)\(x-gm.mu(2,:))')));
MahaDist_3 = @(x) sqrt(diag((x-gm.mu(3,:))*(gm.Sigma(:,:,3)\(x-gm.mu(3,:))')));

dist_1 = MahaDist_1(Y);
idx11 = dist_1 < 3;
idx12 = (dist_1 >= 3) & (dist_1 < 4);
dist_2 = MahaDist_2(Y);
idx21 = dist_2 < 3;
idx22 = (dist_2 >= 3) & (dist_2 < 4);
dist_3 = MahaDist_3(Y);
idx31 = dist_3 < 3;
idx32 = (dist_3 >= 3) & (dist_3 < 4);

figure()
scatter(z1(:,1),z1(:,2),'b','MarkerFaceAlpha',.7,'MarkerEdgeAlpha',.7)
hold on
scatter(z2(:,1),z2(:,2),'b','MarkerFaceAlpha',.7,'MarkerEdgeAlpha',.7)
scatter(z3(:,1),z3(:,2),'b','MarkerFaceAlpha',.7,'MarkerEdgeAlpha',.7)
xlabel("q")
ylabel("qdot")
title("Task Constraints")
scatter(Y(idx11,1),Y(idx11,2),'r','MarkerFaceAlpha',.5,'MarkerEdgeAlpha',.5)
scatter(Y(idx12,1),Y(idx12,2),'k','MarkerFaceAlpha',.5,'MarkerEdgeAlpha',.5)
scatter(Y(idx21,1),Y(idx21,2),'g','MarkerFaceAlpha',.5,'MarkerEdgeAlpha',.5)
scatter(Y(idx22,1),Y(idx22,2),'k','MarkerFaceAlpha',.5,'MarkerEdgeAlpha',.5)
scatter(Y(idx31,1),Y(idx31,2),'m','MarkerFaceAlpha',.5,'MarkerEdgeAlpha',.5)
scatter(Y(idx32,1),Y(idx32,2),'k','MarkerFaceAlpha',.5,'MarkerEdgeAlpha',.5)
xlim([-5,5])
ylim([-5,5])